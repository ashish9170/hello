class TasksController < ApplicationController
  before_action :authenticate_user!

  def index
    @tasks = current_user.tasks
    @assigned_tasks = current_user.assigned_tasks
  end

  def new
    @task = Task.new
    @users = User.where.not(id: current_user.id)
  end

  def create
    @task = current_user.tasks.build(task_params)
    if @task.save
      redirect_to tasks_path, notice: 'Task was successfully created.'
    else
      @users = User.where.not(id: current_user.id)
      Rails.logger.debug @task.errors.full_messages
      render :new
    end
  end

  private

  def task_params
    params.require(:task).permit(:title, :description, :assigned_user_id, tasks_attributes: [:id, :title, :description, :_destroy])
  end
end




task.rb


class Task < ApplicationRecord
  belongs_to :user
  belongs_to :assigned_user, class_name: 'User'
  accepts_nested_attributes_for :assigned_user, allow_destroy: true

end



user.rb

class User < ApplicationRecord
  # Devise modules
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :validatable

  # Associations
  has_many :tasks, foreign_key: :user_id, dependent: :destroy
  has_many :assigned_tasks, class_name: 'Task', foreign_key: :assigned_user_id, dependent: :destroy

  accepts_nested_attributes_for :tasks, allow_destroy: true

end



task_field


<div class="nested-fields">
  <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title %>
  </div>

  <div class="field">
    <%= f.label :description %>
    <%= f.text_area :description %>
  </div>

  <%= link_to_remove_association "Remove Task", f %>
</div>



form


<%= form_with(model: @task, local: true) do |form| %>
  <% if @task.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@task.errors.count, "error") %> prohibited this task from being saved:</h2>
      <ul>
        <% @task.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :title %>
    <%= form.text_field :title %>
  </div>

  <div class="field">
    <%= form.label :description %>
    <%= form.text_area :description %>
  </div>

  <div class="field">
    <%= form.label :assigned_user_id %>
    <%= form.collection_select :assigned_user_id, User.all, :id, :email %>
  </div>

  <div id="tasks">
    <%= form.fields_for :tasks do |task_form| %>
      <%= render 'task_fields', f: task_form %>
    <% end %>
    <div class="links">
      <%= link_to_add_association 'Add Task', form, :tasks, data: { association_insertion_method: :append } %>
    </div>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>




<h1>My Tasks</h1>
<% @tasks.each do |task| %>
  <p>
    <strong>Title:</strong>
    <%= task.title %><br>
    <strong>Description:</strong>
    <%= task.description %><br>
    <strong>Assigned To:</strong>
    <%= task.assigned_user.email %>
  </p>
<% end %>

<h1>Tasks Assigned to Me</h1>
<% @assigned_tasks.each do |task| %>
  <p>
    <strong>Title:</strong>
    <%= task.title %><br>
    <strong>Description:</strong>
    <%= task.description %><br>
    <strong>Assigned By:</strong>
    <%= task.user.email %>
  </p>
<% end %>
<%= link_to "new task" , new_task_path %>
<%= button_to "logout" ,  destroy_user_session_path,method: :delete%>